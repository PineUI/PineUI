{
  "schemaVersion": "1.0.0",
  "state": {
    "activeTab": "home",
    "currentUser": {
      "id": "user_1",
      "username": "mariasilva",
      "displayName": "Maria Silva",
      "avatar": "https://i.pravatar.cc/150?img=5"
    },
    "composer": {
      "text": "",
      "posting": false
    }
  },
  "intents": {
    "post.compose": {
      "handler": {
        "type": "action.overlay.open",
        "overlayId": "composer"
      }
    },
    "post.like": {
      "handler": {
        "type": "action.http",
        "method": "POST",
        "url": "/api/posts/{{postId}}/like"
      }
    },
    "composer.updateText": {
      "handler": {
        "type": "action.state.patch",
        "path": "composer.text",
        "value": "{{text}}"
      }
    },
    "composer.post": {
      "handler": {
        "type": "action.sequence",
        "actions": [
          {
            "type": "action.state.patch",
            "path": "composer.posting",
            "value": true
          },
          {
            "type": "action.http",
            "method": "POST",
            "url": "/api/posts",
            "body": {
              "text": "{{state.composer.text}}"
            }
          },
          {
            "type": "action.state.patch",
            "path": "composer.text",
            "value": ""
          },
          {
            "type": "action.state.patch",
            "path": "composer.posting",
            "value": false
          },
          {
            "type": "action.overlay.close",
            "overlayId": "composer"
          },
          {
            "type": "action.snackbar.show",
            "message": "Post criado com sucesso!",
            "duration": 3000
          }
        ]
      }
    }
  },
  "overlays": {
    "composer": {
      "type": "modal",
      "presentation": "bottomSheet",
      "dismissible": true,
      "child": {
        "type": "layout.column",
        "padding": 16,
        "spacing": 16,
        "children": [
          {
            "type": "layout.row",
            "mainAxisAlignment": "spaceBetween",
            "children": [
              {
                "type": "button.text",
                "label": "Cancelar",
                "onPress": {
                  "type": "action.overlay.close",
                  "overlayId": "composer"
                }
              },
              {
                "type": "button.filled",
                "label": "Postar",
                "disabled": "{{state.composer.text.length === 0}}",
                "onPress": {
                  "intent": "composer.post"
                }
              }
            ]
          },
          {
            "type": "layout.row",
            "spacing": 12,
            "crossAxisAlignment": "start",
            "children": [
              {
                "type": "avatar",
                "src": "{{state.currentUser.avatar}}",
                "size": 48
              },
              {
                "type": "layout.column",
                "spacing": 8,
                "style": { "flex": "1" },
                "children": [
                  {
                    "type": "input.text",
                    "id": "composer_input",
                    "placeholder": "O que est√° acontecendo?",
                    "multiline": true,
                    "maxLines": 10,
                    "maxLength": 280,
                    "autofocus": true,
                    "value": "{{state.composer.text}}",
                    "onChange": {
                      "intent": "composer.updateText",
                      "text": "{{event.value}}"
                    }
                  },
                  {
                    "type": "text",
                    "content": "{{state.composer.text.length}}/280",
                    "style": "bodySmall",
                    "color": "{{state.composer.text.length > 260 ? '#ba1a1a' : '#79747e'}}"
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  },
  "components": {
    "component.postCard": {
      "definition": {
        "type": "card",
        "elevation": 0,
        "padding": 16,
        "child": {
          "type": "layout.column",
          "spacing": 12,
          "children": [
            {
              "type": "layout.row",
              "spacing": 12,
              "crossAxisAlignment": "start",
              "children": [
                {
                  "type": "avatar",
                  "src": "{{props.post.author.avatar}}",
                  "size": 48
                },
                {
                  "type": "layout.column",
                  "spacing": 4,
                  "style": { "flex": "1" },
                  "children": [
                    {
                      "type": "layout.row",
                      "spacing": 4,
                      "children": [
                        {
                          "type": "text",
                          "content": "{{props.post.author.displayName}}",
                          "style": "titleSmall",
                          "fontWeight": "bold"
                        },
                        {
                          "type": "text",
                          "content": "@{{props.post.author.username}}",
                          "style": "bodySmall",
                          "color": "#79747e"
                        },
                        {
                          "type": "text",
                          "content": "¬∑ {{props.post.createdAt | timeAgo}}",
                          "style": "bodySmall",
                          "color": "#79747e"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "content": "{{props.post.content.text}}",
                      "style": "bodyMedium"
                    },
                    {
                      "type": "conditionalRender",
                      "conditions": [
                        {
                          "when": "{{props.post.media != null}}",
                          "render": {
                            "type": "image",
                            "src": "{{props.post.media[0].url}}",
                            "borderRadius": 12,
                            "aspectRatio": 1.78,
                            "style": { "width": "100%", "marginTop": "8px" }
                          }
                        }
                      ]
                    },
                    {
                      "type": "layout.row",
                      "spacing": 24,
                      "style": { "marginTop": "4px" },
                      "children": [
                        {
                          "type": "button.icon",
                          "icon": "üí¨",
                          "label": "{{props.post.metrics.comments}}",
                          "onPress": {
                            "type": "action.snackbar.show",
                            "message": "Coment√°rios em breve!"
                          }
                        },
                        {
                          "type": "button.icon",
                          "icon": "{{props.post.userActions.liked ? '‚ù§Ô∏è' : 'ü§ç'}}",
                          "label": "{{props.post.metrics.likes}}",
                          "color": "{{props.post.userActions.liked ? 'error' : 'onSurfaceVariant'}}",
                          "onPress": {
                            "intent": "post.like",
                            "postId": "{{props.post.id}}"
                          }
                        },
                        {
                          "type": "button.icon",
                          "icon": "‚ÜóÔ∏è",
                          "onPress": {
                            "type": "action.snackbar.show",
                            "message": "Compartilhar em breve!"
                          }
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  },
  "screen": {
    "type": "layout.scaffold",
    "appBar": {
      "title": "Home",
      "actions": [
        {
          "type": "button.icon",
          "icon": "üîç",
          "onPress": {
            "type": "action.snackbar.show",
            "message": "Busca em breve!"
          }
        }
      ]
    },
    "body": {
      "type": "layout.column",
      "children": [
        {
          "type": "collection",
          "layout": "list",
          "itemSpacing": 0,
          "data": {
            "type": "action.http",
            "method": "GET",
            "url": "/api/feed"
          },
          "itemTemplate": {
            "type": "component.postCard",
            "props": {
              "post": "{{item}}"
            }
          },
          "loadingState": {
            "type": "layout.column",
            "padding": 32,
            "crossAxisAlignment": "center",
            "children": [
              {
                "type": "text",
                "content": "Carregando feed...",
                "style": "bodyMedium",
                "color": "#79747e"
              }
            ]
          },
          "emptyState": {
            "type": "layout.column",
            "mainAxisAlignment": "center",
            "crossAxisAlignment": "center",
            "padding": 32,
            "spacing": 16,
            "children": [
              {
                "type": "text",
                "content": "üò∂",
                "style": "headlineLarge",
                "align": "center"
              },
              {
                "type": "text",
                "content": "Seu feed est√° vazio",
                "style": "headlineSmall",
                "align": "center",
                "color": "#49454f"
              },
              {
                "type": "text",
                "content": "Siga pessoas para ver posts aqui",
                "style": "bodyMedium",
                "align": "center",
                "color": "#79747e"
              }
            ]
          },
          "errorState": {
            "type": "layout.column",
            "mainAxisAlignment": "center",
            "crossAxisAlignment": "center",
            "padding": 32,
            "spacing": 16,
            "children": [
              {
                "type": "text",
                "content": "Erro ao carregar feed",
                "style": "titleMedium",
                "color": "#ba1a1a"
              },
              {
                "type": "button.text",
                "label": "Tentar novamente",
                "onPress": {
                  "type": "action.snackbar.show",
                  "message": "Recarregando..."
                }
              }
            ]
          }
        }
      ]
    },
    "floatingActionButton": {
      "icon": "‚úèÔ∏è",
      "onPress": {
        "intent": "post.compose"
      }
    },
    "bottomNav": {
      "items": [
        { "label": "Home", "icon": "üè†", "tab": "home" },
        { "label": "Buscar", "icon": "üîç", "tab": "search" },
        { "label": "Notifica√ß√µes", "icon": "üîî", "tab": "notifications" },
        { "label": "Mensagens", "icon": "‚úâÔ∏è", "tab": "messages" },
        { "label": "Perfil", "icon": "üë§", "tab": "profile" }
      ],
      "activeTab": "{{state.activeTab}}",
      "onTabChange": {
        "type": "action.state.patch",
        "path": "activeTab",
        "value": "{{tab}}"
      }
    }
  }
}
