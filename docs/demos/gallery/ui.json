{
  "schemaVersion": "1.0.0",
  "state": {
    "selectedCategory": "All",
    "selectedCourseIndex": 0,
    "courses": []
  },
  "intents": {
    "category.select": {
      "handler": {
        "type": "action.state.patch",
        "path": "selectedCategory",
        "value": "{{category}}"
      }
    },
    "course.open": {
      "handler": {
        "type": "action.sequence",
        "actions": [
          {
            "type": "action.state.patch",
            "path": "selectedCourseIndex",
            "value": "{{courseIndex}}"
          },
          {
            "type": "action.overlay.open",
            "overlayId": "courseModal"
          }
        ]
      }
    },
    "course.close": {
      "handler": {
        "type": "action.overlay.close",
        "overlayId": "courseModal"
      }
    },
    "course.next": {
      "handler": {
        "type": "action.state.patch",
        "path": "selectedCourseIndex",
        "value": "{{(state.selectedCourseIndex + 1) % state.courses.length}}"
      }
    },
    "course.prev": {
      "handler": {
        "type": "action.state.patch",
        "path": "selectedCourseIndex",
        "value": "{{state.selectedCourseIndex === 0 ? state.courses.length - 1 : state.selectedCourseIndex - 1}}"
      }
    }
  },
  "overlays": {
    "courseModal": {
      "type": "modal",
      "presentation": "modal",
      "dismissible": true,
      "child": {
        "type": "layout.column",
        "children": [
          {
            "type": "layout.row",
            "mainAxisAlignment": "spaceBetween",
            "padding": 16,
            "style": {
              "background": "white",
              "borderBottom": "1px solid #E7E0EC"
            },
            "children": [
              {
                "type": "text",
                "content": "Course Details",
                "style": "titleLarge"
              },
              {
                "type": "button.text",
                "label": "✕",
                "onPress": {
                  "intent": "course.close"
                }
              }
            ]
          },
          {
            "type": "layout.row",
            "style": {
              "minHeight": "calc(100vh - 80px)"
            },
            "children": [
              {
                "type": "layout.column",
                "style": {
                  "flex": "2",
                  "background": "#1D1B20",
                  "padding": "24px",
                  "justifyContent": "center",
                  "alignItems": "center"
                },
                "children": [
                  {
                    "type": "layout.row",
                    "mainAxisAlignment": "center",
                    "crossAxisAlignment": "center",
                    "style": {
                      "gap": "16px",
                      "alignItems": "center"
                    },
                    "children": [
                      {
                        "type": "button.filled",
                        "label": "←",
                        "style": {
                          "borderRadius": "50%",
                          "width": "48px",
                          "height": "48px",
                          "padding": "0",
                          "fontSize": "24px"
                        },
                        "onPress": {
                          "intent": "course.prev"
                        }
                      },
                      {
                        "type": "layout.column",
                        "style": {
                          "maxWidth": "600px",
                          "width": "100%"
                        },
                        "children": [
                          {
                            "type": "image",
                            "src": "{{state.courses[state.selectedCourseIndex].image}}",
                            "style": {
                              "borderRadius": "12px",
                              "width": "100%",
                              "maxHeight": "70vh",
                              "objectFit": "contain"
                            }
                          },
                          {
                            "type": "text",
                            "content": "{{state.selectedCourseIndex + 1}} / {{state.courses.length}}",
                            "style": "bodySmall",
                            "color": "white",
                            "align": "center",
                            "style": {
                              "marginTop": "16px",
                              "color": "rgba(255,255,255,0.7)"
                            }
                          }
                        ]
                      },
                      {
                        "type": "button.filled",
                        "label": "→",
                        "style": {
                          "borderRadius": "50%",
                          "width": "48px",
                          "height": "48px",
                          "padding": "0",
                          "fontSize": "24px"
                        },
                        "onPress": {
                          "intent": "course.next"
                        }
                      }
                    ]
                  }
                ]
              },
              {
                "type": "layout.column",
                "style": {
                  "flex": "1",
                  "padding": "32px",
                  "gap": "16px",
                  "background": "white",
                  "overflowY": "auto"
                },
                "children": [
                  {
                    "type": "text",
                    "content": "{{state.courses[state.selectedCourseIndex].title}}",
                    "style": "headlineMedium"
                  },
                  {
                    "type": "badge",
                    "label": "{{state.courses[state.selectedCourseIndex].category}}",
                    "color": "primary"
                  },
                  {
                    "type": "text",
                    "content": "Instructor: {{state.courses[state.selectedCourseIndex].instructor || 'Not specified'}}",
                    "style": "bodyLarge"
                  },
                  {
                    "type": "divider",
                    "spacing": 16
                  },
                  {
                    "type": "text",
                    "content": "{{state.courses[state.selectedCourseIndex].description || 'Complete course covering all fundamentals and advanced topics. Perfect for beginners and intermediate learners looking to level up their skills.'}}",
                    "style": "bodyMedium"
                  },
                  {
                    "type": "conditionalRender",
                    "conditions": [
                      {
                        "when": "{{state.courses[state.selectedCourseIndex].progress > 0}}",
                        "render": {
                          "type": "layout.column",
                          "spacing": 8,
                          "style": {
                            "marginTop": "16px"
                          },
                          "children": [
                            {
                              "type": "text",
                              "content": "Your Progress",
                              "style": "labelLarge"
                            },
                            {
                              "type": "progress",
                              "value": "{{state.courses[state.selectedCourseIndex].progress}}",
                              "label": "{{state.courses[state.selectedCourseIndex].progress}}% complete",
                              "color": "primary"
                            }
                          ]
                        }
                      }
                    ]
                  },
                  {
                    "type": "button.filled",
                    "label": "Continue Learning",
                    "fullWidth": true,
                    "style": {
                      "marginTop": "auto"
                    },
                    "onPress": {
                      "type": "action.sequence",
                      "actions": [
                        {
                          "type": "action.snackbar.show",
                          "message": "Opening course..."
                        },
                        {
                          "intent": "course.close"
                        }
                      ]
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  },
  "screen": {
    "type": "layout.scaffold",
    "body": {
      "type": "layout.column",
      "spacing": 16,
      "padding": 16,
      "children": [
        {
          "type": "text",
          "content": "Gallery",
          "style": "titleLarge"
        },
        {
          "type": "layout.row",
          "spacing": 8,
          "children": [
            {
              "type": "chip",
              "label": "All",
              "selected": "{{state.selectedCategory == 'All'}}",
              "onPress": {
                "intent": "category.select",
                "category": "All"
              }
            },
            {
              "type": "chip",
              "label": "Design",
              "selected": "{{state.selectedCategory == 'Design'}}",
              "onPress": {
                "intent": "category.select",
                "category": "Design"
              }
            },
            {
              "type": "chip",
              "label": "Development",
              "selected": "{{state.selectedCategory == 'Development'}}",
              "onPress": {
                "intent": "category.select",
                "category": "Development"
              }
            },
            {
              "type": "chip",
              "label": "Business",
              "selected": "{{state.selectedCategory == 'Business'}}",
              "onPress": {
                "intent": "category.select",
                "category": "Business"
              }
            },
            {
              "type": "chip",
              "label": "Marketing",
              "selected": "{{state.selectedCategory == 'Marketing'}}",
              "onPress": {
                "intent": "category.select",
                "category": "Marketing"
              }
            }
          ]
        },
        {
          "type": "collection",
          "layout": "grid",
          "columns": 3,
          "spacing": 16,
          "data": {
            "type": "action.http",
            "method": "GET",
            "url": "/api/gallery/courses?category={{state.selectedCategory}}",
            "onSuccess": {
              "type": "action.state.patch",
              "path": "courses",
              "value": "{{response}}"
            }
          },
          "itemTemplate": {
            "type": "component.courseCard",
            "props": {
              "course": "{{item}}",
              "index": "{{index}}"
            }
          }
        }
      ]
    }
  },
  "components": {
    "component.courseCard": {
      "type": "component.courseCard",
      "definition": {
        "type": "card",
        "elevation": 1,
        "onPress": {
          "intent": "course.open",
          "courseIndex": "{{props.index}}"
        },
        "child": {
          "type": "layout.column",
          "spacing": 0,
          "children": [
            {
              "type": "image",
              "src": "{{props.course.image}}",
              "borderRadius": 12,
              "aspectRatio": 1.33
            },
            {
              "type": "layout.column",
              "padding": 12,
              "spacing": 8,
              "children": [
                {
                  "type": "text",
                  "content": "{{props.course.title}}",
                  "style": "titleSmall",
                  "fontWeight": "bold"
                },
                {
                  "type": "conditionalRender",
                  "conditions": [
                    {
                      "when": "{{props.course.progress > 0}}",
                      "render": {
                        "type": "progress",
                        "value": "{{props.course.progress}}",
                        "label": "{{props.course.progress}}% complete",
                        "color": "primary"
                      }
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  }
}
