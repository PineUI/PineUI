{
  "schemaVersion": "1.0.0",
  "imports": {
    "components": [
      "../../components/ui/alert/success.json"
    ]
  },
  "state": {
    "retweetPostId": null,
    "showRetweetSuccess": false
  },
  "intents": {
    "retweet.showDialog": {
      "handler": [
        {
          "type": "action.state.patch",
          "path": "retweetPostId",
          "value": "{{postId}}"
        },
        {
          "type": "action.overlay.open",
          "overlayId": "retweetDialog"
        }
      ]
    },
    "retweet.cancel": {
      "handler": {
        "type": "action.overlay.close",
        "overlayId": "retweetDialog"
      }
    },
    "retweet.confirm": {
      "handler": [
        {
          "type": "action.overlay.close",
          "overlayId": "retweetDialog"
        },
        {
          "type": "action.state.patch",
          "path": "showRetweetSuccess",
          "value": true
        },
        {
          "type": "action.delay",
          "duration": 3000
        },
        {
          "type": "action.state.patch",
          "path": "showRetweetSuccess",
          "value": false
        }
      ]
    },
    "post.compose": {
      "handler": {
        "type": "action.overlay.open",
        "overlayId": "composer"
      }
    },
    "post.create": {
      "handler": [
        {
          "type": "action.http",
          "method": "POST",
          "url": "/api/twitter/posts",
          "body": {
            "content": {
              "text": "{{state.composer.text}}"
            }
          }
        },
        {
          "type": "action.overlay.close",
          "overlayId": "composer"
        },
        {
          "type": "action.state.patch",
          "path": "state.composer.text",
          "value": ""
        },
        {
          "type": "action.snackbar.show",
          "message": "Post criado com sucesso! üéâ",
          "duration": 3000
        },
        {
          "type": "action.collection.refresh",
          "collectionId": "feed_posts"
        }
      ]
    },
    "post.like": {
      "handler": [
        {
          "type": "action.http",
          "method": "POST",
          "url": "/api/twitter/posts/{{postId}}/like"
        },
        {
          "type": "action.snackbar.show",
          "message": "Post curtido! ‚ù§Ô∏è",
          "duration": 2000
        }
      ]
    }
  },
  "screen": {
    "type": "layout.scaffold",
    "body": {
      "type": "layout.column",
      "spacing": 0,
      "children": [
        {
          "type": "conditionalRender",
          "conditions": [
            {
              "when": "{{state.showRetweetSuccess}}",
              "render": {
                "type": "layout.row",
                "mainAxisAlignment": "center",
                "padding": 16,
                "children": [
                  {
                    "type": "layout.column",
                    "maxWidth": 800,
                    "flex": 1,
                    "children": [
                      {
                        "type": "component.alert.success",
                        "props": {
                          "title": "Retweeted!",
                          "description": "The post has been shared with your followers."
                        }
                      }
                    ]
                  }
                ]
              }
            }
          ]
        },
        {
          "type": "layout.column",
          "padding": 16,
          "spacing": 16,
          "children": [
            {
              "type": "text",
              "content": "Twitter",
              "style": "titleLarge"
            }
          ]
        },
        {
          "type": "collection",
      "id": "feed_posts",
      "layout": "list",
      "virtualized": true,
      "itemSpacing": 0,
      "data": {
        "type": "action.http",
        "method": "GET",
        "url": "/api/twitter/feed"
      },
      "itemTemplate": {
        "type": "component.postCard",
        "props": {
          "post": "{{item}}"
        }
      },
      "loadingState": {
        "type": "layout.column",
        "mainAxisAlignment": "center",
        "padding": 32,
        "children": [
          {
            "type": "text",
            "content": "Carregando posts...",
            "style": "bodyMedium",
            "color": "onSurfaceVariant"
          }
        ]
      },
      "emptyState": {
        "type": "layout.column",
        "mainAxisAlignment": "center",
        "crossAxisAlignment": "center",
        "padding": 32,
        "children": [
          {
            "type": "text",
            "content": "Nenhum post ainda",
            "style": "headlineSmall"
          }
        ]
      }
        }
      ]
    },
    "floatingActionButton": {
      "type": "button.fab",
      "icon": "‚ûï",
      "label": "Novo post",
      "onPress": {
        "intent": "post.compose"
      }
    }
  },
  "components": {
    "component.postCard": {
      "type": "component.postCard",
      "definition": {
        "type": "card",
        "elevation": 0,
        "padding": 16,
        "child": {
          "type": "layout.column",
          "spacing": 12,
          "children": [
            {
              "type": "layout.row",
              "spacing": 12,
              "crossAxisAlignment": "start",
              "children": [
                {
                  "type": "avatar",
                  "src": "{{props.post.author.avatar}}",
                  "size": 48
                },
                {
                  "type": "layout.column",
                  "flex": 1,
                  "spacing": 8,
                  "children": [
                    {
                      "type": "layout.row",
                      "flex": 1,
                      "mainAxisAlignment": "spaceBetween",
                      "crossAxisAlignment": "start",
                      "children": [
                        {
                          "type": "layout.row",
                          "spacing": 8,
                          "crossAxisAlignment": "center",
                          "children": [
                            {
                              "type": "text",
                              "content": "{{props.post.author.displayName}}",
                              "style": "titleSmall",
                              "fontWeight": "bold"
                            },
                            {
                              "type": "text",
                              "content": "@{{props.post.author.username}}",
                              "style": "bodySmall",
                              "color": "onSurfaceVariant"
                            },
                            {
                              "type": "text",
                              "content": "¬∑",
                              "style": "bodySmall",
                              "color": "onSurfaceVariant"
                            },
                            {
                              "type": "text",
                              "content": "{{props.post.createdAt | timeAgo}}",
                              "style": "bodySmall",
                              "color": "onSurfaceVariant"
                            }
                          ]
                        },
                        {
                          "type": "button.icon",
                          "icon": "‚ãÆ",
                          "size": "small"
                        }
                      ]
                    },
                    {
                      "type": "text",
                      "content": "{{props.post.content.text}}",
                      "style": "bodyMedium"
                    },
                    {
                      "type": "conditionalRender",
                      "conditions": [
                        {
                          "when": "{{props.post.media != null}}",
                          "render": {
                            "type": "image",
                            "src": "{{props.post.media[0].url}}",
                            "borderRadius": 12
                          }
                        }
                      ]
                    },
                    {
                      "type": "layout.row",
                      "mainAxisAlignment": "spaceBetween",
                      "crossAxisAlignment": "center",
                      "spacing": 16,
                      "children": [
                        {
                          "type": "button.icon",
                          "icon": "üí¨",
                          "size": "small",
                          "color": "onSurfaceVariant",
                          "label": "{{props.post.metrics.comments}}"
                        },
                        {
                          "type": "button.icon",
                          "icon": "üîÅ",
                          "size": "small",
                          "color": "onSurfaceVariant",
                          "label": "{{props.post.metrics.retweets}}",
                          "onPress": {
                            "intent": "retweet.showDialog",
                            "postId": "{{props.post.id}}"
                          }
                        },
                        {
                          "type": "button.icon",
                          "icon": "{{props.post.userActions.liked ? '‚ù§Ô∏è' : 'ü§ç'}}",
                          "size": "small",
                          "color": "{{props.post.userActions.liked ? 'error' : 'onSurfaceVariant'}}",
                          "label": "{{props.post.metrics.likes}}",
                          "onPress": {
                            "intent": "post.like",
                            "postId": "{{props.post.id}}"
                          }
                        },
                        {
                          "type": "button.icon",
                          "icon": "‚ÜóÔ∏è",
                          "size": "small",
                          "color": "onSurfaceVariant"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      }
    }
  },
  "overlays": {
    "retweetDialog": {
      "type": "overlay.modal",
      "presentation": "modal",
      "dismissible": true,
      "child": {
        "type": "layout.column",
        "padding": 24,
        "spacing": 16,
        "backgroundColor": "#FFFBFE",
        "borderRadius": 28,
        "maxWidth": 400,
        "children": [
          {
            "type": "layout.column",
            "spacing": 8,
            "children": [
              {
                "type": "text",
                "content": "Retweet this post?",
                "style": "headlineSmall",
                "fontWeight": "bold",
                "color": "#1D1B20"
              },
              {
                "type": "text",
                "content": "This will share the post with your followers.",
                "style": "bodyMedium",
                "color": "#49454F",
                "lineHeight": 1.5
              }
            ]
          },
          {
            "type": "layout.row",
            "spacing": 8,
            "mainAxisAlignment": "end",
            "children": [
              {
                "type": "button.text",
                "label": "Cancel",
                "onPress": {
                  "intent": "retweet.cancel"
                }
              },
              {
                "type": "button.filled",
                "label": "Retweet",
                "onPress": {
                  "intent": "retweet.confirm"
                }
              }
            ]
          }
        ]
      }
    },
    "composer": {
      "type": "overlay.modal",
      "presentation": "bottomSheet",
      "dismissible": true,
      "child": {
        "type": "layout.column",
        "padding": 16,
        "spacing": 16,
        "children": [
          {
            "type": "layout.row",
            "mainAxisAlignment": "spaceBetween",
            "children": [
              {
                "type": "button.text",
                "label": "Cancelar",
                "onPress": {
                  "type": "action.overlay.close",
                  "overlayId": "composer"
                }
              },
              {
                "type": "text",
                "content": "Novo Post",
                "style": "titleMedium",
                "fontWeight": "bold"
              },
              {
                "type": "button.filled",
                "label": "Postar",
                "onPress": {
                  "intent": "post.create"
                }
              }
            ]
          },
          {
            "type": "layout.row",
            "spacing": 12,
            "crossAxisAlignment": "start",
            "children": [
              {
                "type": "avatar",
                "src": "{{state.currentUser.avatar}}",
                "size": 48
              },
              {
                "type": "layout.column",
                "flex": 1,
                "spacing": 12,
                "children": [
                  {
                    "type": "input.text",
                    "id": "composer_input",
                    "placeholder": "O que est√° acontecendo?",
                    "multiline": true,
                    "maxLines": 10,
                    "maxLength": 280,
                    "autofocus": true,
                    "value": "{{state.composer.text}}",
                    "onChanged": {
                      "type": "action.state.patch",
                      "path": "state.composer.text",
                      "value": "{{value}}"
                    }
                  },
                  {
                    "type": "layout.row",
                    "mainAxisAlignment": "spaceBetween",
                    "children": [
                      {
                        "type": "layout.row",
                        "spacing": 8,
                        "children": [
                          {
                            "type": "button.icon",
                            "icon": "üì∑",
                            "color": "primary"
                          },
                          {
                            "type": "button.icon",
                            "icon": "üé•",
                            "color": "primary"
                          }
                        ]
                      },
                      {
                        "type": "text",
                        "content": "{{state.composer.text.length || 0}}/280",
                        "style": "bodySmall",
                        "color": "onSurfaceVariant"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    }
  }
}
